box: python:3.6.1
dev:
  steps:
    - install-packages:
        packages: openssh-client shellcheck
    - script:
        name: install dependences
        code: make install env=dev
# Build definition
build:
  # The steps that will be executed on build
  steps:

    - install-packages:
        packages: openssh-client shellcheck

    - add-ssh-key:
        keyname: GITHUB_KEY
        host: github.com

    - add-to-known_hosts@2.0.1:
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa

    - script:
        name: install dependences
        code: |
          make install env=dev

  after-steps:
    - install-packages:
        packages: ruby

    - script:
        name: Show vars env
        code: |
            env

    - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_WEBHOOK_URL
        channel: $SLACK_CHANNEL
        username: $SLACK_USERNAME
        passed_message: "Great!!! :smile:"
        failed_message: "Oh noooo :scream:"
        notify_on: "failed"

# Testing definition
test:
  steps:
    - install-packages:
        packages: openssh-client shellcheck

    - add-ssh-key:
        keyname: GITHUB_KEY
        host: github.com

    - add-to-known_hosts@2.0.1:
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa

    - script:
        name: install dependences
        code: |
          make install env=test

    - script:
        name: Run lint code
        code: |
          make test.lint

    - script:
        name: Run Test Integration tests
        code: |
          make test.syntax

  after-steps:
    - install-packages:
        packages: ruby

    - script:
        name: Show vars env
        code: |
            env

    - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_WEBHOOK_URL
        channel: $SLACK_CHANNEL
        username: $SLACK_USERNAME
        passed_message: "Genial!!! :smile:"
        failed_message: "Oh noooo :scream:"
        notify_on: "failed"

# Documentation definition
documentation:

  box:
    id: labpositiva/latex:3.6.1
    cmd: /bin/bash

  steps:
    - install-packages:
        packages: openssh-client shellcheck

    - add-ssh-key:
        keyname: GITHUB_KEY
        host: github.com

    - add-to-known_hosts@2.0.1:
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa

    - script:
        name: install dependences
        code: |
          pip install --no-cache -r requirements/docs.txt

    - script:
        name: Execute Docs to pdf
        code: |
          cd docs && make latexpdf

    - script:
        name: Execute Docs to html
        code: |
          cd docs && make html

  after-steps:
    - install-packages:
        packages: ruby

    - script:
        name: Show vars env
        code: |
            env

    - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_WEBHOOK_URL
        channel: $SLACK_CHANNEL
        username: $SLACK_USERNAME
        passed_message: "Genial!!! :smile:"
        failed_message: "Oh noooo :scream:"
        notify_on: "failed"
